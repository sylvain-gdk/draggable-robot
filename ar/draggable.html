<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Robot Puzzle</title>
    <link rel="stylesheet" type="text/css" href="stylesheet.css">
  </head>

  <body>
    <script src="https://code.jquery.com/jquery-3.3.1.js""></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://digital.nightspublications.com/js/jquery.ui.touch-punch.min.js"></script>
    <script>
      // counts until puzzle is completed
      var count = 1;

      window.addEventListener("load", function(){
        rotate('image1', 'img1', random());
        rotate('image2', 'img2', random());
        rotate('image3', 'img3', random());
        rotate('image4', 'img4', random());
        rotate('image5', 'img5', random());
      });

      // random degree for rotation
      function random(){
        var degree = [90, 180, 270];
        return degree[Math.floor(Math.random()*degree.length)];
      }

      function tolerance(origin, target){
        var ok = false;
        var check1 = origin - target;
        var check2 = target - origin;

        if((check1 >= 0 && check1 <=1) || (check2 >= 0 && check2 <= 1)){
          ok = true
        }
        return ok;
      }

      // compares position of one piece against target
      function compare(id, ui, target){
        if(tolerance(ui.position.top, target.offsetTop) && tolerance(ui.position.left, target.offsetLeft)){
          // adds 1 when puzzle piece is in place
          count++;
          // disables drag when puzzle piece is in place
          $( id ).draggable( "disable" );
          // shows next piece of puzzle
          var img = 'img' + count;
          if(count < 6){
            var imgId = document.getElementById(img);
            imgId.style.display = "block";
          }else{
            let hide = document.getElementsByTagName("img");
            for(var i = 0; i < hide.length; i++){
              hide[i].style.display = "none";
            }
            // shows animation when puzzle is completed
            var animate = document.getElementById("animate");
            animate.style.display = 'block';
            var again = document.getElementById("again");
            again.innerHTML = "Play again?";
          }
        }
      }

      // rotates the piece of puzzle when clicked until in the right position
      function rotate(figId, imgId, amount) {
        var figure = document.getElementById(figId);
        var img = document.getElementById(imgId);
        var imgWidth = img.clientWidth/2;
        var imgHeight = img.clientHeight/2;
        var translateString = 'translate(' + imgWidth + ', ' + imgHeight + ')';
        var figString = 'start ui-draggable ui-draggable-handle rotate' + amount + ' ' + translateString;
        figure.setAttribute("class", figString);
        var rotateString = 'rotate("' + figId + '", "' + imgId + '", ' + amount + ')';
        img.addEventListener("touchstart", function(event){
          rotate(figId, imgId, amount+90);
          event.preventDefault();
        });
      }
      // calls the draggable puzzle pieces
      $( function() {
        $( "#image1" ).draggable({
          snap: ".ui-widget-image2",
          snapMode: "inner",
          opacity: 0.35,
          containment: 'parent',
          stop: function(event, ui){
            let target = document.getElementById("snaptarget2");
            compare(this, ui, target);
          }
        });
      } );

      $( function() {
        $( "#image2").draggable({
          snap: ".ui-widget-image4",
          snapMode: "inner",
          opacity: 0.35,
          containment: "body",
          stop: function(event, ui){
            let target = document.getElementById("snaptarget4");
            compare(this, ui, target);
          }
        });
      } );

      $( function() {
        $( "#image3" ).draggable({
          snap: ".ui-widget-image5",
          snapMode: "inner",
          opacity: 0.35,
          containment: "body",
          stop: function(event, ui){
            let target = document.getElementById("snaptarget5");
            compare(this, ui, target);
          }
        });
      } );

      $( function() {
        $( "#image4" ).draggable({
          snap: ".ui-widget-image6",
          snapMode: "inner",
          opacity: 0.35,
          containment: "body",
          stop: function(event, ui){
            let target = document.getElementById("snaptarget6");
            compare(this, ui, target);
          }
        });
      } );

      $( function() {
        $( "#image5" ).draggable({
          snap: ".ui-widget-image8",
          snapMode: "inner",
          opacity: 0.35,
          containment: "body",
          stop: function(event, ui){
            let target = document.getElementById("snaptarget8");
            compare(this, ui, target);
          }
        });
      } );

    </script>

    <div>
      <img id = "animate" src="./images/robot-character_ANIME.gif" style='display: none'/>
    </div>

    <figure>
      <img src="./images/robot-character_EMPTY_01.png"/>
    </figure>

    <figure id="snaptarget2" class="ui-widget-image2">
      <img src="./images/robot-character_EMPTY_02.png"/>
    </figure>

    <figure>
      <img src="./images/robot-character_EMPTY_03.png"/>
    </figure>

    <figure id="snaptarget4" class="ui-widget-image4">
      <img src="./images/robot-character_EMPTY_04.png"/>
    </figure>

    <figure id="snaptarget5" class="ui-widget-image5">
      <img src="./images/robot-character_EMPTY_05.png"/>
    </figure>

    <figure id="snaptarget6" class="ui-widget-image6">
      <img src="./images/robot-character_EMPTY_06.png"/>
    </figure>

    <figure>
      <img src="./images/robot-character_EMPTY_07.png"/>
    </figure>

    <figure id="snaptarget8" class="ui-widget-image8">
      <img src="./images/robot-character_EMPTY_08.png"/>
    </figure>

    <figure>
      <img src="./images/robot-character_EMPTY_09.png"/>
    </figure>

    <figure id="image1" class="start">
      <img id="img1" src="./images/robot-character_BCKG1.png"/>
    </figure>

    <figure id="image2" class="start" >
      <img  id="img2" src="./images/robot-character_BCKG2.png" style="display: none"/>
    </figure>

    <figure id="image3" class="start">
      <img id="img3" src="./images/robot-character_BCKG3.png" style="display: none"/>
    </figure>

    <figure id="image4" class="start">
      <img id="img4" src="./images/robot-character_BCKG4.png" style="display: none"/>
    </figure>

    <figure id="image5" class="start">
      <img id="img5" src="./images/robot-character_BCKG5.png" style="display: none"/>
    </figure>

    <button id="again" onclick="location.href='./draggable.html'" >Reset</button>

  </body>
</html>